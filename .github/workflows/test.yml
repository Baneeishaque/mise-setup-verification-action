name: Test Action

on: 
  push:
  pull_request:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4.2.2
        with:
          fetch-depth: 1
          
      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@2.0.0
        with:
          scandir: './src'
          
      - name: Run actionlint
        uses: reviewdog/action-actionlint@v1.71.1
        with:
          fail_level: error

  test:
    needs: lint
    name: Test Mise Setup Verification
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4.2.2
        with:
          fetch-depth: 1

      - name: Run Action (Self-Test)
        uses: ./
        with:
          mise_version: '2025.12.9'
          working_directory: 'tests'
          tool_name: 'python'
          version_command: 'python -V'
          install: 'true'
          cache: 'true'
          mise_file: 'mise.toml'

      - name: Verify Output
        run: echo "Action completed successfully."
